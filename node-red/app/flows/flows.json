[
    {
        "id": "3de292d6.8a219e",
        "type": "tab",
        "label": "Coffee roaster",
        "disabled": false,
        "info": ""
    },
    {
        "id": "39113e59.d16132",
        "type": "redis-config",
        "z": "",
        "host": "redis",
        "port": "{{REDIS_PORT}}",
        "dbase": "{{REDIS_DB}}",
        "pass": ""
    },
    {
        "id": "324de882.178998",
        "type": "redis-in",
        "z": "3de292d6.8a219e",
        "server": "39113e59.d16132",
        "command": "subscribe",
        "name": "set.heat",
        "topic": "set.heat",
        "timeout": 0,
        "x": 110,
        "y": 120,
        "wires": [
            [
                "e137997d.9a27a8",
                "feae6c2d.92ede"
            ]
        ]
    },
    {
        "id": "e2810af5.3d35c8",
        "type": "redis-out",
        "z": "3de292d6.8a219e",
        "server": "39113e59.d16132",
        "command": "lpush",
        "name": "log.heat",
        "topic": "log.heat",
        "x": 820,
        "y": 340,
        "wires": []
    },
    {
        "id": "e137997d.9a27a8",
        "type": "function",
        "z": "3de292d6.8a219e",
        "name": "Create log",
        "func": "var time_stamp = Math.floor(Date.now());\nmsg.payload = {'timestamp': time_stamp, 'value': msg.payload};\nmsg.topic = 'log.' + msg.topic.replace('set.', '')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 340,
        "wires": [
            [
                "e2810af5.3d35c8"
            ]
        ]
    },
    {
        "id": "41b73eac.481a6",
        "type": "inject",
        "z": "3de292d6.8a219e",
        "name": "temperature",
        "topic": "temperature",
        "payload": "0",
        "payloadType": "num",
        "repeat": "2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 140,
        "y": 40,
        "wires": [
            [
                "13e351b.69051ae"
            ]
        ]
    },
    {
        "id": "afe6c4ca.200268",
        "type": "redis-out",
        "z": "3de292d6.8a219e",
        "server": "39113e59.d16132",
        "command": "lpush",
        "name": "log.temperature",
        "topic": "log.temperature",
        "x": 800,
        "y": 400,
        "wires": []
    },
    {
        "id": "ef63d82c.eb0ce8",
        "type": "function",
        "z": "3de292d6.8a219e",
        "name": "Create log",
        "func": "var time_stamp = Math.floor(Date.now());\nmsg.payload = {'timestamp': time_stamp, 'value': msg.payload};\nmsg.topic = 'log.' + msg.topic.replace('set.', '')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 400,
        "wires": [
            [
                "afe6c4ca.200268"
            ]
        ]
    },
    {
        "id": "3153bc65.fe2654",
        "type": "join",
        "z": "3de292d6.8a219e",
        "name": "10s group",
        "mode": "custom",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "5",
        "reduceRight": false,
        "reduceExp": "($I = 0) ? payload : (($I = $N - 1) ? (payload - $A) : $A)",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 180,
        "y": 340,
        "wires": [
            [
                "ab6e40c4.c44b4"
            ]
        ]
    },
    {
        "id": "ab6e40c4.c44b4",
        "type": "function",
        "z": "3de292d6.8a219e",
        "name": "Rate of change",
        "func": "var last = msg.payload[msg.payload.length - 1];\nvar first = msg.payload[0];\n// Rate of change in degrees per minute\nmsg.payload = (last - first) * 6;\nmsg.topic = msg.topic + '_roc'\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "x": 340,
        "y": 400,
        "wires": [
            [
                "4c473704.876bc8"
            ]
        ]
    },
    {
        "id": "4c473704.876bc8",
        "type": "function",
        "z": "3de292d6.8a219e",
        "name": "Create log",
        "func": "var time_stamp = Math.floor(Date.now());\nmsg.payload = {'timestamp': time_stamp, 'value': msg.payload};\nmsg.topic = 'log.' + msg.topic.replace('set.', '')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 460,
        "wires": [
            [
                "e2a7e869.5163f8"
            ]
        ]
    },
    {
        "id": "e2a7e869.5163f8",
        "type": "redis-out",
        "z": "3de292d6.8a219e",
        "server": "39113e59.d16132",
        "command": "lpush",
        "name": "log.temperature_roc",
        "topic": "log.temperature_roc",
        "x": 780,
        "y": 460,
        "wires": []
    },
    {
        "id": "13e351b.69051ae",
        "type": "exec",
        "z": "3de292d6.8a219e",
        "command": "python /usr/src/thermocouple.py --clk=25 --cs=24 --do=18 --samples=10",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "read_max31855",
        "x": 380,
        "y": 40,
        "wires": [
            [
                "8c5288df.21ed68"
            ],
            [],
            []
        ]
    },
    {
        "id": "8c5288df.21ed68",
        "type": "csv",
        "z": "3de292d6.8a219e",
        "name": "",
        "sep": ",",
        "hdrin": "",
        "hdrout": "",
        "multi": "one",
        "ret": "\\n",
        "temp": "thermocouple,internal",
        "skip": "0",
        "x": 650,
        "y": 40,
        "wires": [
            [
                "ccda49e0.40fdc8"
            ]
        ]
    },
    {
        "id": "ccda49e0.40fdc8",
        "type": "template",
        "z": "3de292d6.8a219e",
        "name": "thermocouple",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.thermocouple}}",
        "output": "json",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "ef63d82c.eb0ce8",
                "3153bc65.fe2654"
            ]
        ]
    },
    {
        "id": "feae6c2d.92ede",
        "type": "rpi-gpio out",
        "z": "3de292d6.8a219e",
        "name": "ssr",
        "pin": "40",
        "set": "",
        "level": "0",
        "freq": "1",
        "out": "pwm",
        "x": 830,
        "y": 180,
        "wires": []
    }
]